# Building the game

This document is to capture learning from, and required actions for, release builds.

## WebGL

### Compression

Due to issues with the initial Brotli-compressed build which could not be resolved through server configuration, compression should be deactivated in Unity's player settings when building to WebGL.

### Amendments to generated web page

**Edit 2025-03-20:** The below no longer seems to be applicable. Recent builds were successfully deployed at https://cardpeegee.vaent.uk without the HTML/CSS changes, and no audio issues were observed. This section can be considered archived, the detail is only retained in case the issue reappears in future.

Modern browsers will most likely not allow the AudioContext to be started automatically (user interaction is required). During initial testing in Chrome, the "preload" scene stayed silent until an interaction was registered - e.g. mouse click or keypress - then began playing its audio files from the start, so that they were out of sync with the visuals. If the first interaction registered was a click on the "Play game" button it produced a short, harsh, meaningless sound before the main game music kicked in.

To avoid this problem, the `index.html` generated by Unity must be modified as follows.

- Locate the `script.onload` event handler relating to the `loader.js` file; it should be near the bottom of the HTML body. Remove the `onload` statement, and assign the function to `var clickToStartFunction` instead.
- Inside that function, add new lines: `removeEventListener('click', clickToStartFunction);` and `document.getElementById("click-start-prompt")?.remove();`. These can be inserted at the start of the function, before `createUnityInstance` is invoked.
- Below the function, insert a new line: `addEventListener('click', clickToStartFunction);`
- Locate the `<div id="unity-container" class="unity-desktop">` element which should be near the top of the HTML body.
- Add a `<div id="click-start-prompt">Click to run the game</div>` element within the `unity-container`.

Also add the following definition to Unity's `styles.css` (in the TemplateData folder):

`#click-start-prompt { position: absolute; left: 0; top: 10%; width: 100%; text-align: center; color: lightGrey; font-family: arial; font-size: 32px }`
